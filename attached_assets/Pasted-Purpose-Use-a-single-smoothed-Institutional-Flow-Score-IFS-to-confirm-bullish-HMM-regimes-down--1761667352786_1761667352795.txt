Purpose

Use a single, smoothed Institutional Flow Score (IFS) to confirm bullish HMM regimes, down-weight weak ones, and scale Kelly. This is a confidence overlay, not a new predictor inside the HMM.

Data Inputs (per ticker, rolling)

Institutional Holdings %Î” (q/q)

ğ»
ğ‘¡
=
InstHold
ğ‘¡
âˆ’
InstHold
ğ‘¡
âˆ’
1
InstHold
ğ‘¡
âˆ’
1
H
t
	â€‹

=
InstHold
tâˆ’1
	â€‹

InstHold
t
	â€‹

âˆ’InstHold
tâˆ’1
	â€‹

	â€‹


Source: 13F aggregation (WhaleWisdom/Fintel/EDGAR) â†’ quarterly.

Convert to a z-score within ticker (12-quarter window):

Z
ğ»
=
ğ»
ğ‘¡
âˆ’
ğœ‡
(
ğ»
)
ğœ
(
ğ»
)
Z
H
	â€‹

=
Ïƒ(H)
H
t
	â€‹

âˆ’Î¼(H)
	â€‹


Relative Volume z-score (daily)

ğ‘…
ğ‘‰
=
ğ‘‰
ğ‘œ
ğ‘™
â€¾
5
ğ‘‘
âˆ’
ğ‘‰
ğ‘œ
ğ‘™
â€¾
100
ğ‘‘
ğœ
(
ğ‘‰
ğ‘œ
ğ‘™
100
ğ‘‘
)
RV=
Ïƒ(Vol
100d
	â€‹

)
Vol
5d
	â€‹

âˆ’
Vol
100d
	â€‹

	â€‹


Accumulation/Distribution (A/D) oscillator (daily)

Money Flow Multiplier:

MFM
ğ‘‘
=
(
ğ¶
âˆ’
ğ¿
)
âˆ’
(
ğ»
âˆ’
ğ¶
)
ğ»
âˆ’
ğ¿
MFM
d
	â€‹

=
Hâˆ’L
(Câˆ’L)âˆ’(Hâˆ’C)
	â€‹

 (define 0 when 
ğ»
=
ğ¿
H=L)

Money Flow Volume: 
MFV
ğ‘‘
=
MFM
ğ‘‘
Ã—
ğ‘‰
ğ‘œ
ğ‘™
ğ‘‘
MFV
d
	â€‹

=MFM
d
	â€‹

Ã—Vol
d
	â€‹


A/D line: 
AD
ğ‘¡
=
âˆ‘
MFV
ğ‘‘
AD
t
	â€‹

=âˆ‘MFV
d
	â€‹


Normalized slope over lookback 
ğ¿
=
20
L=20:

AD_slope
=
slope
(
AD
ğ‘¡
âˆ’
ğ¿
.
.
ğ‘¡
)
M
A
D
(
AD
ğ‘¡
âˆ’
120..
ğ‘¡
)
AD_slope=
MAD(AD
tâˆ’120..t
	â€‹

)
slope(AD
tâˆ’L..t
	â€‹

)
	â€‹


(MAD = median absolute deviation). Clip to 
[
âˆ’
2
,
+
2
]
[âˆ’2,+2].

Short-Interest Change (optional, weekly)

Days-to-Cover: 
DTC
ğ‘¡
=
ShortInterest
ğ‘¡
ğ‘‰
ğ‘œ
ğ‘™
â€¾
30
ğ‘‘
DTC
t
	â€‹

=
Vol
30d
	â€‹

ShortInterest
t
	â€‹

	â€‹


Improvement (de-crowding) is bullish: 
Î”
DTC
=
âˆ’
(
DTC
ğ‘¡
âˆ’
DTC
ğ‘¡
âˆ’
1
)
Î”DTC=âˆ’(DTC
t
	â€‹

âˆ’DTC
tâˆ’1
	â€‹

)

z-score within ticker (52-week window): 
Z
ğ·
ğ‘‡
ğ¶
Z
DTC
	â€‹

.

Raw Institutional Flow Score

Weights default to emphasize verifiable holdings delta and real-time volume:

ğ‘¤
1
=
0.45
,
â€…â€Š
ğ‘¤
2
=
0.25
,
â€…â€Š
ğ‘¤
3
=
0.20
,
â€…â€Š
ğ‘¤
4
=
0.10
w
1
	â€‹

=0.45,w
2
	â€‹

=0.25,w
3
	â€‹

=0.20,w
4
	â€‹

=0.10

IFS
ğ‘¡
ğ‘Ÿ
ğ‘
ğ‘¤
=
ğ‘¤
1
â‹…
Z
ğ»
+
ğ‘¤
2
â‹…
ğ‘…
ğ‘‰
+
ğ‘¤
3
â‹…
AD_slope
+
ğ‘¤
4
â‹…
Z
ğ·
ğ‘‡
ğ¶
IFS
t
raw
	â€‹

=w
1
	â€‹

â‹…Z
H
	â€‹

+w
2
	â€‹

â‹…RV+w
3
	â€‹

â‹…AD_slope+w
4
	â€‹

â‹…Z
DTC
	â€‹


Clip: 
IFS
ğ‘¡
ğ‘Ÿ
ğ‘
ğ‘¤
âˆˆ
[
âˆ’
3
,
+
3
]
IFS
t
raw
	â€‹

âˆˆ[âˆ’3,+3].

Smoothing & Rescale

Use an EMA with a half-life of 21 trading days (Î± implied by half-life).

IFS
ğ‘¡
=
E
M
A
ğ»
ğ¿
=
21
â€‰â£
(
IFS
ğ‘¡
ğ‘Ÿ
ğ‘
ğ‘¤
)
IFS
t
	â€‹

=EMA
HL=21
	â€‹

(IFS
t
raw
	â€‹

)

Then rescale to 
[
âˆ’
2
,
+
2
]
[âˆ’2,+2] by linear mapping using a rolling 1-year min/max (winsorize 5/95th).

Integration 1 â€” Posterior Regime Confidence

You already have 
ğ‘ƒ
ğ‘
ğ‘¢
ğ‘™
ğ‘™
=
ğ‘ƒ
(
bull
âˆ£
obs
)
P
bull
	â€‹

=P(bullâˆ£obs) from HMM.

Bayesian-style adjustment (logit shift):

logit
(
ğ‘
)
=
ln
â¡
ğ‘
1
âˆ’
ğ‘
logit(p)=ln
1âˆ’p
p
	â€‹


Parameter 
ğ›¾
=
0.6
Î³=0.6 (tune 0.3â€“0.9)

ğ‘ƒ
~
ğ‘
ğ‘¢
ğ‘™
ğ‘™
=
ğœ
â€‰â£
(
logit
(
ğ‘ƒ
ğ‘
ğ‘¢
ğ‘™
ğ‘™
)
+
ğ›¾
â‹…
IFS
ğ‘¡
)
P
~
bull
	â€‹

=Ïƒ(logit(P
bull
	â€‹

)+Î³â‹…IFS
t
	â€‹

)

where 
ğœ
(
ğ‘¥
)
=
1
1
+
ğ‘’
âˆ’
ğ‘¥
Ïƒ(x)=
1+e
âˆ’x
1
	â€‹

.

Effect: positive IFS nudges the posterior toward bull; negative IFS does the oppositeâ€”without retraining the HMM.

Integration 2 â€” Kelly Scaling

Let 
ğ¾
ğ‘
ğ‘
ğ‘ 
ğ‘’
K
base
	â€‹

 be your Kelly fraction from edge/odds.
Use a convex multiplier with guardrails:

ğ›½
=
0.25
Î²=0.25 (tune 0.1â€“0.4)

Cap Kelly in 
[
0
,
ğ¾
ğ‘š
ğ‘
ğ‘¥
]
[0,K
max
	â€‹

] (e.g., 
ğ¾
ğ‘š
ğ‘
ğ‘¥
=
0.25
K
max
	â€‹

=0.25)

ğ¾
ğ‘
ğ‘‘
ğ‘—
=
min
â¡
â€‰â£
(
ğ¾
ğ‘š
ğ‘
ğ‘¥
,
â€…â€Š
ğ¾
ğ‘
ğ‘
ğ‘ 
ğ‘’
â‹…
(
1
+
ğ›½
â‹…
IFS
ğ‘¡
)
)
K
adj
	â€‹

=min(K
max
	â€‹

,K
base
	â€‹

â‹…(1+Î²â‹…IFS
t
	â€‹

))

Floor at zero.

Decision Bands (default)
IFS	Posterior & Kelly Guidance
> +1.0	Treat as confirming inflow. Use 
ğ‘ƒ
~
ğ‘
ğ‘¢
ğ‘™
ğ‘™
P
~
bull
	â€‹

 and 
ğ¾
ğ‘
ğ‘‘
ğ‘—
K
adj
	â€‹

 (often â†‘ 15â€“30%).
0 to +1.0	Mild confirmation. Maintain.
-1.0 to 0	Caution. Reduce 
ğ¾
ğ‘
ğ‘‘
ğ‘—
K
adj
	â€‹

 10â€“20%.
< -1.0	Strong outflow. Trim/exit unless HMM bull is very high (>0.8).
Output Contract (for your UI & logs)

Emit a single row per ticker per day with:

ticker

date

P_bull_raw (from HMM)

IFS_raw, IFS_smoothed

P_bull_adj (posterior after logit shift)

kelly_base, kelly_adj

decision âˆˆ {Increase, Maintain, Reduce, Exit}

notes (e.g., â€œ13F â†‘ 1.8Ïƒ; RV z=1.2; AD_slope=0.9â€)

(Provide this field list to Replit; theyâ€™ll wire it to your existing table.)

Validation Rules (must pass)

Stability: If any component is missing (e.g., no 13F), compute IFS with available parts and renormalize weights to sum to 1. Log which components were missing.

Clipping: Apply the stated clip/winsorization exactly to avoid outliers exploding signals.

Monotonicity test: When IFS rises by â‰¥1.0 while HMM 
ğ‘ƒ
ğ‘
ğ‘¢
ğ‘™
ğ‘™
P
bull
	â€‹

 is flat (Â±0.05), 
ğ‘ƒ
~
ğ‘
ğ‘¢
ğ‘™
ğ‘™
P
~
bull
	â€‹

 must rise.

Guardrails: 
0
â‰¤
ğ¾
ğ‘
ğ‘‘
ğ‘—
â‰¤
ğ¾
ğ‘š
ğ‘
ğ‘¥
0â‰¤K
adj
	â€‹

â‰¤K
max
	â€‹

.

Reproducibility: Same inputs â†’ same outputs (seed independence).

Backtest Protocol (A/B)

Run With IFO vs Without IFO over your existing 145â€“180-day windows:

Primary: improvement in regime precision (bullish signal true-positive rate)

Secondary: portfolio Sharpe and max drawdown

Tertiary: average Kelly utilization (lower variance with same or higher return)

Pass criteria (suggested):

â‰¥ 5â€“10% lift in bullish precision

Same or lower max DD

Same or higher Sharpe